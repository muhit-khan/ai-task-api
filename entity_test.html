<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML Entity Test</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #0f0f0f;
            color: #f7f7f7;
            padding: 20px;
            line-height: 1.6;
        }

        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: #171717;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #3e3e3e;
        }

        .test-case {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #2a2a2a;
            border-radius: 8px;
            background: #1e1e1e;
        }

        .before {
            background: #2d1b1b;
            padding: 10px;
            margin: 10px 0;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
        }

        .after {
            background: #1b2d1b;
            padding: 10px;
            margin: 10px 0;
            border-radius: 6px;
            font-size: 14px;
        }

        button {
            background: #0066cc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px 5px;
        }

        button:hover {
            background: #0052a3;
        }
    </style>
</head>

<body>
    <div class="test-container">
        <h1>ðŸ§ª HTML Entity Decoding Test</h1>
        <p>Testing our improved HTML entity decoding with the exact problematic text.</p>

        <div class="test-case">
            <h3>Test 1: Basic HTML Entities</h3>
            <button onclick="testBasicEntities()">Test Basic Entities</button>
            <div class="before" id="basic-before"></div>
            <div class="after" id="basic-after"></div>
        </div>

        <div class="test-case">
            <h3>Test 2: Your Exact Problematic Text</h3>
            <button onclick="testProblematicText()">Test Problematic Text</button>
            <div class="before" id="problem-before"></div>
            <div class="after" id="problem-after"></div>
        </div>

        <div class="test-case">
            <h3>Test 3: Full Content with Multiple Entities</h3>
            <button onclick="testFullContent()">Test Full Content</button>
            <div class="before" id="full-before"></div>
            <div class="after" id="full-after"></div>
        </div>
    </div>

    <script>
        // Copy our improved HTML entity decoding functions
        function decodeHtmlEntities(text) {
            if (!text) return '';

            // Create a temporary div element to decode HTML entities
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = text;
            let decoded = tempDiv.textContent || tempDiv.innerText || '';

            // Additional manual decoding for common entities that might still be present
            const entityMap = {
                '&#039;': "'",
                '&quot;': '"',
                '&amp;': '&',
                '&lt;': '<',
                '&gt;': '>',
                '&#x27;': "'",
                '&#x2F;': '/',
                '&#x60;': '`',
                '&#x3D;': '='
            };

            // Replace any remaining HTML entities
            for (const [entity, char] of Object.entries(entityMap)) {
                decoded = decoded.replace(new RegExp(entity, 'g'), char);
            }

            return decoded;
        }

        function cleanHtmlEntities(html) {
            if (!html) return '';

            return html
                .replace(/&#039;/g, "'")
                .replace(/&quot;/g, '"')
                .replace(/&amp;/g, '&')
                .replace(/&lt;/g, '<')
                .replace(/&gt;/g, '>')
                .replace(/&#x27;/g, "'")
                .replace(/&#x2F;/g, '/')
                .replace(/&#x60;/g, '`')
                .replace(/&#x3D;/g, '=');
        }

        function testBasicEntities() {
            const testText = "We&#039;re testing &#039;HTML entities&#039; &quot;like these&quot; &amp; more!";

            document.getElementById('basic-before').textContent = 'Raw: ' + testText;
            document.getElementById('basic-after').textContent = 'Cleaned: ' + cleanHtmlEntities(testText);
        }

        function testProblematicText() {
            const problematicText = "Big news! We&#039;re thrilled to share that [Wife&#039;s Name] is pregnant! Baby due in [Month, Year].";

            document.getElementById('problem-before').textContent = 'Raw: ' + problematicText;
            document.getElementById('problem-after').textContent = 'Cleaned: ' + cleanHtmlEntities(problematicText);
        }

        function testFullContent() {
            const fullContent = `Option 1: Excited & Playful

> We&#039;ve got some HUGE news to share! ðŸ‘¶ðŸ¼ Turns out, [Wife&#039;s Name] and I have been working on a little side project... and it&#039;s due [Month, Year]! We&#039;re beyond excited (and slightly terrified ðŸ¤ª) to be welcoming a little one into our lives.

Option 2: Sweet & Sentimental

> Our hearts are overflowing! â¤ï¸ [Wife&#039;s Name] and I are so incredibly happy to announce that we&#039;re expecting a baby in [Month, Year]!

Option 3: Simple & Heartfelt

> Big news! We&#039;re thrilled to share that [Wife&#039;s Name] is pregnant! Baby due in [Month, Year].`;

            document.getElementById('full-before').innerHTML = '<strong>Raw:</strong><br>' + fullContent.replace(/\\n/g, '<br>');
            document.getElementById('full-after').innerHTML = '<strong>Cleaned:</strong><br>' + cleanHtmlEntities(fullContent).replace(/\\n/g, '<br>');
        }

        // Auto-test on load
        window.onload = function () {
            testBasicEntities();
            testProblematicText();
            testFullContent();
        };
    </script>
</body>

</html>